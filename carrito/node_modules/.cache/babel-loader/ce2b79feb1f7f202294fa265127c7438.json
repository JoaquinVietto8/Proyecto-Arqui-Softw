{"ast":null,"code":"import React, { useContext, useEffect, useState } from \"react\";\nimport Cookies from \"universal-cookie\";\nimport swal from \"sweetalert2\";\nconst Cookie = new Cookies();\nconst id_user = setUser();\n\nfunction setUser() {\n  let cookieUser = Cookie.get(\"user\");\n\n  if (cookieUser != undefined) {\n    let array = cookieUser.split(\",\");\n    return array[0];\n  } else {\n    return \"undefined\";\n  }\n}\n\nfunction vaciarCarrito() {\n  document.cookie = \"cart\" + id_user + \"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;\";\n}\n\nexport const CrearOrden = () => {\n  let cookie = Cookie.get(\"user\");\n  let id_user = parseInt(cookie.split(\",\")[0]);\n  let orderDetails = {\n    'id_product': 0,\n    'cantidad': 0\n  };\n  let OrderDetails_ = [];\n  let a = Cookie.get(\"cart\" + id_user).split(\";\");\n\n  for (let i = 0; i < a.length; i++) {\n    let item = a[i];\n\n    if (item != \"\") {\n      let array = item.split(\",\");\n      orderDetails = {\n        'id_product': 0,\n        'cantidad': 0\n      };\n      orderDetails.id_product = parseInt(array[0]);\n      orderDetails.cantidad = parseInt(array[1]);\n      OrderDetails_.push(orderDetails);\n    }\n  }\n\n  const crearOrden = async () => {\n    fetch('http://localhost:8080/new-order', requestOptions).then(response => {\n      if (response.status != 201) {\n        swal.fire({\n          icon: 'error',\n          text: \"No se pudo realizar la compra\"\n        }).then(result => {\n          if (result.isConfirmed) {\n            window.location.reload();\n            return response.json();\n          }\n        });\n      } else {\n        swal.fire({\n          icon: 'success',\n          text: \"Compra realizada con éxito, puede ver su historial de compras en mis compras\"\n        }).then(result => {\n          if (result.isConfirmed) {\n            window.location.replace(\"/\");\n            vaciarCarrito();\n            return response.json();\n          }\n        });\n      }\n    });\n  };\n\n  const requestOptions = {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      id_user: id_user,\n      OrderDetails: OrderDetails_\n    })\n  };\n  crearOrden();\n};\n_c = CrearOrden;\n\nvar _c;\n\n$RefreshReg$(_c, \"CrearOrden\");","map":{"version":3,"names":["React","useContext","useEffect","useState","Cookies","swal","Cookie","id_user","setUser","cookieUser","get","undefined","array","split","vaciarCarrito","document","cookie","CrearOrden","parseInt","orderDetails","OrderDetails_","a","i","length","item","id_product","cantidad","push","crearOrden","fetch","requestOptions","then","response","status","fire","icon","text","result","isConfirmed","window","location","reload","json","replace","method","headers","body","JSON","stringify","OrderDetails"],"sources":["C:/Users/Joaquin/Desktop/Proyecto-Arqui-Softw/carrito/src/componentes/Compras/nueva-compra.js"],"sourcesContent":["import React, { useContext, useEffect, useState} from \"react\";\r\nimport Cookies from \"universal-cookie\";\r\nimport swal from \"sweetalert2\";\r\n\r\nconst Cookie = new Cookies();\r\nconst id_user = setUser()\r\n\r\nfunction setUser (){\r\n  let cookieUser = Cookie.get(\"user\")\r\n\r\n  if(cookieUser!=undefined){\r\n  let array = cookieUser.split(\",\")\r\n  return array[0]\r\n  }else{\r\n    return \"undefined\"\r\n  }\r\n}\r\n\r\nfunction vaciarCarrito(){\r\n   \r\n    document.cookie = \"cart\"+id_user+\"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;\";\r\n}\r\nexport const CrearOrden = ()=>{\r\n  \r\n\r\n    let cookie = Cookie.get(\"user\")\r\n    let id_user = parseInt(cookie.split(\",\")[0]);\r\n    let orderDetails ={'id_product':0,'cantidad':0}\r\n    let OrderDetails_ = [];\r\n\r\n    let a = Cookie.get(\"cart\"+id_user).split(\";\")\r\n \r\n\r\n    for (let i = 0; i < a.length; i++){\r\n      let item = a[i];\r\n      if(item != \"\"){\r\n        let array = item.split(\",\")\r\n        orderDetails ={'id_product':0,'cantidad':0}\r\n        orderDetails.id_product = parseInt(array[0])\r\n        orderDetails.cantidad =parseInt(array[1])\r\n         \r\n        OrderDetails_.push(orderDetails)\r\n        \r\n      }\r\n    }\r\n    \r\n    \r\n    const crearOrden = async()=>{\r\n      fetch('http://localhost:8080/new-order',requestOptions)\r\n      .then(response => {if (response.status != 201) {\r\n        swal.fire({icon: 'error', text:\"No se pudo realizar la compra\"}\r\n        ).then((result) => {\r\n          if (result.isConfirmed) {\r\n            window.location.reload();\r\n            return response.json()\r\n          }}) \r\n       }else{\r\n        swal.fire({icon: 'success', text:\"Compra realizada con éxito, puede ver su historial de compras en mis compras\"}\r\n          ).then((result) => {\r\n            if (result.isConfirmed) {\r\n              window.location.replace(\"/\")\r\n              vaciarCarrito()\r\n              return response.json()\r\n            }})\r\n         \r\n        }})\r\n      };\r\n      const requestOptions={\r\n        method: 'POST',\r\n        headers: {'Content-Type': 'application/json'},\r\n        \r\n        body: JSON.stringify({\r\n             id_user: id_user,\r\n             OrderDetails: OrderDetails_\r\n    })\r\n    };\r\n     \r\n    crearOrden();\r\n\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}